CANopen协议分为用户应用层、对象字典（核心）以及通信
CANopen定义：小网络、控制信号的实时通讯
NMT网络管理命令、Sync同步报文、Emergency紧急报文
can应用层：数据类型、编码规则、对象字典、CANopen通信服务协议
标准帧：8个字节数据和11位标识符
扩展帧：8个字节数据和29位标识符

通信协议分类：不同通信协议的原则和消息传输触发的可用模式
本地服务、提供者主动发起的服务、无应答服务、应答服务
主/从协议     客户端/服务器协议      生产者/消费者协议

物理层和数据链层的本质作用是构建网络通信、访问通道
物理层：介质相关接口、物理介质连接、物理信令
（物理线路永久存在且不可删除）
数据链路层：数据封装以帧为单位进行传输，提高传输效率且能做（数据传输差错控制）？

应用层：为网络中每一个有效设备都提供一组有用的服务与协议
数据类型：bool 布尔式，true or false ； void 数据值未定义，长度为n  ；  unsigned int   非负整数   ； signed int 取值范围为-2的n-1到2的n-1次方-1； 浮点数 ；
通信对象：服务和协议
	过程数据对象（PD0）：过程数据，即单向传输，无需接收节点回应CAN报文
	服务数据对象（SD0）：服务数据，有指定被接受节点地址，并需要指定的接收节点回应CAN报文（轮询式）
	发送TPD0和接收RPD0
	PD0的CAN-ID定义：数据长度为1-8
	PD0的通信参数： COB-ID、传输类型、定时周期
	PD0的映射参数： 通信参数、应用数据和具体CAN报文中数据
	SD0的通讯原则： 发送方发送CAN-ID为600h+Node-ID的报文，数据长度均为8字节；接收方接收后，回应580h+Node-ID
	快速SD0协议：看桌面示意图
	SD0同步协议：一般选用80h为同步报文   2个约束条件：索引1007h约束了同步帧发送后，从节点发送PD0的时效   通讯循环周期：1006h规定了同步帧的循环周期
	紧急报文协议：CAN-ID存储在1014h中，定义为080h+Node-ID
预定义的CAN-ID（COB-ID）分配表，4位功能码和7位的节点号
传输模式：同步传输
	 事件驱动传输
触发模式：事件和定时器驱动
	 远程请求
	 同步触发
PD0写服务（推模式），PD0读服务（拉模式）	
寻址PD0(MPD0)：① 目的地址模式（DAM）MPD0		②源地址模式（SAM）MPD0

                   对象                    规范               CAN-ID（COB-ID）  
TPDO1 发送过程数据对象 1 CiA301 181h to 1FFh（180h +node-ID）
RPDO1 接收过程数据对象 1 CiA301 201h to 27Fh（200h +node-ID）
TPDO2 发送过程数据对象 2 CiA301 281h to 2FFh（280h +node-ID）
RPDO2 接收过程数据对象 2 CiA301 301h to 37Fh（300h +node-ID）
TPDO3 发送过程数据对象 3 CiA301 381h to 3FFh（380h +node-ID）
RPDO3 接收过程数据对象 3 CiA301 401h to 47Fh（400h +node-ID）
TPDO4 发送过程数据对象 4 CiA301 481h to 4FFh（480h +node-ID）
RPDO4 接收过程数据对象 4 CiA301 501h to 57Fh（500h +node-ID）
Default SDO server-to-client 服务数据对象“答” CiA301 581h to 5FFh（580h +node-ID）
Default SDO client-to-server 服务数据对象“问” CiA301 601h to 67Fh（600h +node-ID）

对象字典OD（objec dictionary）
对象采用16位的索引值来寻址，索引范围在0x0000-0xFFFF抑或子索引u8 0x00-0xFF

   索引范围                                             描述
1000h to 1FFFh Communication profile area 通讯对象子协议区
2000h to 5FFFh Manufacturer-specific profile area 制造商特定子协议区
6000h to 9FFFh Standardized profile area 标准化设备子协议区

CANopen节点上电开始的6种状态：
①初始化    ②应用层复位    ③通讯复位    ④预操作状态     ⑤操作状态   ⑥停止状态
NMT节点状态切换命令：第一个字节代表命令类型：01h为启动，02h为停止，80h为进入预操作，81h为复为节点应用层，82h为复位节点通讯
		       第二个代表被控制节点Node-ID

elmo指令集
主要用um=2，5模式
AG[N]为模拟量增益数组，其含义取决于运行模式 UM=2时，模拟输入每伏特电压AG[2]；AN[N]报告电机测量电流    AS[N]模拟输入偏移量数组     
BG  为开始运动     UM=2，激活上一次运动速度JV及新的平滑因数SF、加速度AC和减速度DC       UM=5，激活上一次位置模式：点对点PA、持续运动JV或PVT或PT
BP[N]为制动参数，BP[1]-电机禁用后，制动器接合的延迟时间   BP[2]启用后分离所需的延迟时间    BT-在定义时间开始运动    BV-最大电机直流电压
CA[N]为整流换相数组，其包括初始电机设置参数
CA[15] 进行“无霍尔”换相搜索的信号频率，其计算公式为：Time=128*TS*2的CA【15】次方*-e的-6次方
CA[24]执行结构分析的最小电机动作
CA[26]电机启动时换相搜索过程的起动转矩，起动转矩=（CA[26]/100）*CL[1]；
CC 编译程序已经就绪    CD CPU转储
CL[N]电流持续限制及电机阻滞保护参数  CL[1]最大允许持续电机相电流    CL[2]持续电流限制CL[1]的百分比
DC 减速度（UM=2，PM=1）、位置点到点及持续JV（UM=5）
DD CAN控制器状态    出现总线关闭、CAN总线上存在许多错误帧、对CAN控制器错误活动进行监视     

EC错误代码
EO应答模式  =1 启用  =0 禁用
ER[N] 最大跟踪误差  ER[2]最大允许速度误差（abs（DV[2]-VX））    ER[3]最大允许的位置错误（abs（DV[3]-PX））
FF[N] 前馈     对UM=5大多数情况，FF[2]=1
FR[N]跟随器比率   FR[1]定义电流跟随器比率（UM=1）  FR[2]定义速率跟随器比率（UM=2） FR[3]定义位置的跟随器比率
IL[N]输入逻辑   定义输入端口的逻辑电平和函数行为
行为： 1： 立即在控制下停机  2：忽略  3：通用目的   4：仅硬启用正向  5:仅硬启用反向  6：开始
JV持续运动速度	目的：设定电机速度  UM=2，JV规定“软”速度命令	UM=5，JV设定恒定速度的软件命令
KI[N]-PI参数，	KI[1],KP[1]定义PI电流控制过滤器
KP[N]		KI[2],KP[2]定义PI速度控制过滤器	KP[3]定义位置控制器增益
KV[N] 控制器的高阶过滤器参数
LL[N] 低反馈限值  速度限值	LL[2]、HL[2]定义电机允许速度的限值范围	
LS[N] 列出用户程序		重新获得用户程序及得到驱动器的特征数据
MC[N]	驱动器最大峰值电流		驱动器允许的最大相电流
MF 电机故障	目的：电机自动关闭原因	
MI 屏蔽中断	选择哪些中断可以执行	
MI值 		被屏蔽中断 	相应的例行程序
1(0x1) 		未使用 		          0
2(0x2) 		异常中止 		   AUTO_ER
4(0x4) 		软件终止		 AUTO_STOP
8(0x8) 		软件启动		 AUTO_BG
16(0x10) 		反向限位输入信号 	  AUTO_RLS
32(0x20) 		正向限位输入信号 	  AUTO_FLS
64(0x40) 		切换允许 		  AUTO_ENA
128(0x80) 	数字输入1 	   AUTO_I1
256(0x100) 	数字输入2 	   AUTO_I2
512(0x200) 	数字输入3 	   AUTO_I3
1024(0x400) 	数字输入4 	   AUTO_I4
2048(0x800) 	数字输入5 	   AUTO_I5
4096(0x1000) 	数字输入6 	   AUTO_I
8192(0x2000) 	主归位事件	  AUTO_HM
16,384(0x4000) 	辅助归位事件 	  AUTO_HY
32,768(0x8000) 	用户程序错误 	 AUTO_PERR
MO-电机启用/禁用		MO=0禁用
MP[N]-运动（PT/PVT）参数	QP[N]保存位置参考点	QV[N]、QT[N]保存PVT运动额外需要的速度和定时数据
MP[1]	运动设置阵列的第一个下标	MP[2]设置阵列的最后一个下标		
MS-运动状态	报告运动轨迹处理的状态	UM=5	0  电机位置稳定，反馈位置信息恒定	1 位置控制器的参考位置不变或电机关闭		2位置控制器的参考位置由可选的运动轨迹定制器
OC[N] 输出比较	OC[1]=1绝对位置模式：第一个脉冲在OC[2]初始化的绝对位置产生	OC[1]=2  立即模式	OC[3]定义位置间隔连续输出	OC[4]：每个脉冲的延续时间	OC[5]产生脉冲的机会数目			UM=2	1  电机关闭   速度控制器的参考即速度目标	2  速度控制器的软件参考不同于速度目标  
OL[N] 输出逻辑	输出端的逻辑电平及功能行为
OP -输出端口	
PA -绝对位置	下一个软件位置命令是PTP	
PE  -位置误差	返回当前的位置跟踪误差	UM=5下，PE=DV[3]-PX;PE按模数XM[N]读取，取较短的路径。
PL[N] -峰值延续和门限	PL[1]定义电机最大峰值电流，单位为安培；PL[2]定义电机最大峰值延续，单位为秒
PM-运动轨迹定制器模式	UM=2，	PM=1,AC、DC和SF命令正常使用
PP[N]-协议参数		程序设置所有的通信参数  PP[1]=1：RS-232	PP[2]：RS-232波特率 5：115200   4：57600
PP[13]CANopen设备标识符1-127	PP[14]CANopen波特率	PP[15]CAN组标识符
PR-相对位置	声明下一个软件位置命令是PTP，PR可应用于任意活动的运动模式中，只有下一个BG启动时，PR才被激活
PS-程序状态	0：用户程序暂停	-1：没有用户程序线程运行
PT-位置时间命令	从QP[N]数组中读取位置参考值，BG命令启动后，PT运动从QP[PT]开始。
PV-位置速度时间命令	在QT[N]给出的时间从QP[N]和QV[N]读取新的相对位置和速度值，在QP[N]和QV[N]数组的输入之间运动，MP[N]给出运动过程使用的QP[N]、QV[N]和QT[N]	
QP[N],QT[N],QV[N]-位置、时间、速度	保存PT和PVT运动模式下的数据。
RC-对记录变量进行定义	定义哪些信号将被记录
RL-记录长度	同时记录的信号总数	1    长度4096      2   长度2048     3   长度1365     4   长度1024
RR-激活记录器/读记录器状态		目的：启动记录器，终止正在进行的记录过程或读取记录器状态	0    终止记录器	1   下一个BG命令产生时开始记录	2   立即开始记录
RS-软重置	目的：驱动器初始化为出厂默认状态，将所有易失变量重置到上电的缺省值
SD-停止时的减速度	目的：紧急情况下按计数/秒定义减速来停止运动
SP-PTP模式速度	目的：设置点对点的最大速度。由AC加速度加速到SP，保持恒定的SP速度，最后由DC减速度减到停止状态。
ST-停止运动	目的：停止程序运动	在MO=0和UM=1时无效
TC-转矩命令	目的：UM=1/UM=3下，设置转矩命令，以安培为单位。
TM-系统时间	目的：读取和写入系统时间
UF[N]用户浮点数组		UI[N]用户整型数组
UM-运行模式	2  速度控制模式（由JV程序持续运动命令或模拟参考值信号直接设置）  5单回路位置控制（点对点（PA）命令、持续运动（JV）或平面运动（PT,PVT））
VE-速度错误	VH[N],VL[N]-高和低参考限值		驱动器最大和最小速度及位置参考限值
XC,XQ-执行或继续运行程序
elmo驱动器根据控制器和命令状态进行时序安排
ID-有功电流   IQ-无功电流	无刷电机在其相位上携带交流电，交流电产生一个旋转磁场，此磁场可投影到两个方向，一个沿着转子的磁场方向，不产生机械转矩。另一个垂直于转子的磁场方向并产生机械转矩。
补充知识：
电压跟随器即共集电极电路，基极电压与集电极电压相位相同。电路主要特点：高输入电阻、低输出电阻、电压增益近似1
其作用是：缓冲：避免信号在前级的输出电阻中损耗，加入跟随器进行缓冲
	 隔离：断开负反馈回路以消除大环路负反馈的弊端
位运算知识：！位取反  ~数字取负  ^位异或   &位与  | 位或  <<左移
比特位数组(位数组)	有效利用内存空间设计的存储数据方式，以二进制存储，方便检测是否被调用过元素
同步和异步的区别：同步是强依赖，即必须等到回应才进行下一步操作。十分耗时，适用于短指令。
	               异步是弱依赖，即若响应，则运行其操作；不响应，执行之前操作。











